terraform {
  backend "consul" {
    address = "1.1.1.1"
    path    = "remote-state-file/psql"
  }
}

// Configure the Google Cloud provider
provider "google" {
  credentials = "${file("account.json")}"
  project     = "myproject_ID_12344"
  region      = "us-east1-b"
}


resource "google_sql_database_instance" "master1" {
  name = "postgres-instance-2"
  database_version = "POSTGRES_9_6"
  region = "us-central1"

  settings {
    # Second-generation instance tiers are based on the machine
    # type. See argument reference below.
    tier = "db-f1-micro"
        ip_configuration {
        authorized_networks = {
                name = "tf-node"
                value = "1.1.1.1/32"
                expiration_time = "2018-06-15T16:19:00.094Z"
    }
        }
  }
}
resource "google_sql_database" "default" {
        name = "testdb"
        instance  = "${google_sql_database_instance.master1.name}"
}

resource "random_id" "user-password" {
  byte_length = 8
}

resource "google_sql_user" "default" {
  name     = "postgres"
  instance = "${google_sql_database_instance.master1.name}"
  host     = "%"
  password = "${random_id.user-password.hex}"

provisioner "local-exec" {
        command = "pass the shell script or commands to import DDL DML"
}
}
